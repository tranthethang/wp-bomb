(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var s in a)e.o(a,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:a[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,s=window.wp.components,r=window.wp.apiFetch;var n=e.n(r);const c=window.wp.i18n,l=()=>{const[e,r]=(0,a.useState)(""),[l,i]=(0,a.useState)(""),[m,o]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!0),[p,f]=(0,a.useState)(null);(0,a.useEffect)(()=>{g()},[]);const g=async()=>{try{const e=await n()({path:"/craftsman-suite/v1/auto-attach-thumbnail/stats"});e.success&&(r(e.min_id),i(e.max_id))}catch(e){console.error("Failed to fetch stats",e)}finally{u(!1)}};return(0,t.createElement)("div",{className:"craftsman-suite-module mb-8"},(0,t.createElement)("div",{className:"mb-6"},(0,t.createElement)("h2",{className:"text-2xl font-medium text-gray-800 mb-2"},(0,c.__)("Auto Attach Thumbnail","craftsman-suite")),(0,t.createElement)("p",{className:"text-[13px] text-wp-sub leading-relaxed max-w-4xl"},(0,c.__)("This module scans posts within the specified ID range and automatically attaches the first image found in the content as the featured image (thumbnail) if one is not already set.","craftsman-suite"))),p&&(0,t.createElement)(s.Notice,{status:p.type,onRemove:()=>f(null),className:"mb-4"},p.message),(0,t.createElement)(s.PanelBody,{className:"bg-white border border-wp-border shadow-wp-card rounded-sm overflow-hidden p-0"},(0,t.createElement)("form",{onSubmit:async t=>{if(t.preventDefault(),confirm((0,c.__)("Are you sure you want to attach thumbnails? This will set thumbnails for posts based on the specified ID range.","craftsman-suite"))){o(!0),f(null);try{const t=await n()({path:"/craftsman-suite/v1/auto-attach-thumbnail/execute",method:"POST",data:{min_id:parseInt(e),max_id:parseInt(l)}});t.success&&f({type:"success",message:t.message})}catch(e){f({type:"error",message:e.message||(0,c.__)("An error occurred during execution.","craftsman-suite")})}finally{o(!1)}}},className:"p-6 space-y-6"},d?(0,t.createElement)("div",{className:"flex justify-center py-4"},(0,t.createElement)(s.Spinner,null)):(0,t.createElement)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6"},(0,t.createElement)("div",{className:"space-y-2"},(0,t.createElement)(s.TextControl,{label:(0,c.__)("Min ID","craftsman-suite"),type:"number",value:e,onChange:e=>r(e),help:(0,c.__)("Starting post ID for the operation.","craftsman-suite"),required:!0,min:"0"})),(0,t.createElement)("div",{className:"space-y-2"},(0,t.createElement)(s.TextControl,{label:(0,c.__)("Max ID","craftsman-suite"),type:"number",value:l,onChange:e=>i(e),help:(0,c.__)("Ending post ID for the operation.","craftsman-suite"),required:!0,min:"0"}))),(0,t.createElement)("div",{className:"bg-gray-50 border-t border-wp-border px-6 py-4 flex items-center justify-end"},(0,t.createElement)(s.Button,{variant:"primary",type:"submit",isBusy:m,disabled:m,icon:"controls-play",className:"flex items-center gap-2"},(0,c.__)("Execute","craftsman-suite"))))))},i=()=>{const[e,r]=(0,a.useState)("settings"),[l,i]=(0,a.useState)("idle"),[m,o]=(0,a.useState)({batchSize:Number(window.craftsmanSuiteData?.batch_size||1),selectedSizes:[],skipExisting:!1}),[d,u]=(0,a.useState)({}),[p,f]=(0,a.useState)(!0),[g,x]=(0,a.useState)(null),[b,h]=(0,a.useState)({total:0,processed:0,completed:0,failed:0,pending:0,percentage:0,startTime:null,duration:0}),[E,w]=(0,a.useState)(""),[y,_]=(0,a.useState)([]),N=(0,a.useRef)(!0),v=(0,a.useRef)(!1);(0,a.useEffect)(()=>(S(),()=>{N.current=!1}),[]);const S=async()=>{try{const e=await n()({path:"/craftsman-suite/v1/regenerate-thumbnails/sizes"});N.current&&e.success&&(u(e.sizes),o(t=>({...t,selectedSizes:Object.keys(e.sizes)})))}catch(e){console.error("Failed to fetch sizes",e)}finally{f(!1)}},k=async(e,t,a,s)=>{if(!N.current||v.current)return void(v.current&&i("stopped"));if(t>=e.length){const e=Date.now(),t=Math.round((e-s)/1e3);return h(e=>({...e,duration:t,pending:0,percentage:100})),void i("completed")}const r=e.slice(t,t+m.batchSize);try{const c=await n()({path:"/craftsman-suite/v1/regenerate-thumbnails/batch-process",method:"POST",data:{attachment_ids:r,selected_sizes:m.selectedSizes,skip_existing:m.skipExisting}});if(!N.current||v.current)return void(v.current&&i("stopped"));const l=c.results||{};let o=a.completed,d=a.failed,u="";Object.values(l).forEach(e=>{e.success?(o++,u=e.filename):d++});const p=t+r.length,f=Math.round(p/e.length*100);h(t=>({...t,processed:p,completed:o,failed:d,pending:e.length-p,percentage:f})),u&&w(u),await new Promise(e=>setTimeout(e,50)),k(e,p,{completed:o,failed:d},s)}catch(e){console.error("Batch failed",e),i("error"),x({type:"error",message:(0,c.__)("Batch processing failed.","craftsman-suite")})}},C=()=>{v.current=!0},z=()=>{r("settings"),i("idle"),h({total:0,processed:0,completed:0,failed:0,pending:0,percentage:0,startTime:null,duration:0}),w(""),x(null)};return(0,t.createElement)("div",{className:"craftsman-suite-module mt-8"},(0,t.createElement)("div",{className:"mb-6"},(0,t.createElement)("h2",{className:"text-2xl font-medium text-gray-800 mb-2"},(0,c.__)("Regenerate Thumbnails","craftsman-suite")),(0,t.createElement)("p",{className:"text-[13px] text-wp-sub leading-relaxed max-w-4xl"},(0,c.__)("This tool regenerates thumbnails for all image attachments. This is useful if you have changed your theme or one of your thumbnail dimensions.","craftsman-suite"))),"settings"===e?(0,t.createElement)(s.PanelBody,{className:"bg-white border border-wp-border shadow-wp-card rounded-sm overflow-hidden p-0"},(0,t.createElement)("div",{className:"divide-y divide-gray-100"},(0,t.createElement)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 p-6 items-start"},(0,t.createElement)("div",{className:"md:col-span-1"},(0,t.createElement)("label",{className:"text-sm font-semibold text-wp-heading"},(0,c.__)("Images per Batch","craftsman-suite")),(0,t.createElement)("p",{className:"text-xs text-gray-500 mt-1 leading-relaxed"},(0,c.__)("The number of images processed in a single AJAX request.","craftsman-suite"))),(0,t.createElement)("div",{className:"md:col-span-2"},(0,t.createElement)(s.RangeControl,{value:m.batchSize,onChange:e=>o({...m,batchSize:e}),min:1,max:50,help:(0,c.__)("Low (1–10) for shared hosting, High (20+) for dedicated servers.","craftsman-suite")}))),(0,t.createElement)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 p-6 items-start"},(0,t.createElement)("div",{className:"md:col-span-1"},(0,t.createElement)("label",{className:"text-sm font-semibold text-wp-heading"},(0,c.__)("Target Thumbnail Sizes","craftsman-suite")),(0,t.createElement)("p",{className:"text-xs text-gray-500 mt-1 leading-relaxed"},(0,c.__)("Select specific sizes to regenerate to save time and resources.","craftsman-suite"))),(0,t.createElement)("div",{className:"md:col-span-2 space-y-3"},p?(0,t.createElement)(s.Spinner,null):Object.entries(d).map(([e,a])=>(0,t.createElement)(s.CheckboxControl,{key:e,label:a,checked:m.selectedSizes.includes(e),onChange:t=>{const a=t?[...m.selectedSizes,e]:m.selectedSizes.filter(t=>t!==e);o({...m,selectedSizes:a})}})))),(0,t.createElement)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 p-6 items-start"},(0,t.createElement)("div",{className:"md:col-span-1"},(0,t.createElement)("label",{className:"text-sm font-semibold text-wp-heading"},(0,c.__)("Advanced Options","craftsman-suite"))),(0,t.createElement)("div",{className:"md:col-span-2"},(0,t.createElement)(s.CheckboxControl,{label:(0,c.__)("Skip existing correctly sized thumbnails","craftsman-suite"),help:(0,c.__)("Only regenerate if the file is missing or dimensions are incorrect.","craftsman-suite"),checked:m.skipExisting,onChange:e=>o({...m,skipExisting:e})})))),(0,t.createElement)("div",{className:"bg-gray-50 border-t border-wp-border px-6 py-4 flex items-center justify-end"},(0,t.createElement)(s.Button,{variant:"primary",onClick:async()=>{v.current=!1,i("loading"),r("progress"),x(null);try{const e=await n()({path:"/craftsman-suite/v1/regenerate-thumbnails/attachments"});if(!N.current)return;if(e.success){const t=e.attachment_ids;_(t);const a={total:e.total,processed:0,completed:0,failed:0,pending:e.total,percentage:0,startTime:Date.now(),duration:0};h(a),i("processing"),k(t,0,{completed:0,failed:0},a.startTime)}}catch(e){console.error("Failed to start process",e),i("error"),x({type:"error",message:(0,c.__)("Failed to start the process.","craftsman-suite")})}},disabled:0===m.selectedSizes.length},(0,c.__)("Start Regenerating Thumbnails","craftsman-suite")))):(()=>{const e="completed"===l,a="stopped"===l,r="processing"===l;return(0,t.createElement)(s.Card,{className:"bg-wp-surface border border-wp-border shadow-wp-card sm:rounded-sm"},(0,t.createElement)(s.CardHeader,{className:"px-4 py-4 sm:px-6 border-b border-wp-border flex justify-between items-center bg-white"},(0,t.createElement)("h3",{className:"text-sm font-semibold text-gray-900"},(0,c.__)("Progress","craftsman-suite")),(0,t.createElement)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(e?"bg-green-100 text-green-800":r?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800")},l.charAt(0).toUpperCase()+l.slice(1))),(0,t.createElement)(s.CardBody,{className:"p-4 sm:p-6 space-y-6"},(0,t.createElement)("div",{className:"space-y-2"},(0,t.createElement)("div",{className:"flex justify-between text-sm text-wp-sub mb-1"},(0,t.createElement)("span",null,(0,c.__)("Processing image","craftsman-suite")," ",(0,t.createElement)("strong",null,b.processed)," ",(0,c.__)("of","craftsman-suite")," ",(0,t.createElement)("strong",null,b.total)),(0,t.createElement)("span",{className:"font-medium text-gray-800"},b.percentage,"%")),(0,t.createElement)(s.ProgressBar,{value:b.percentage,className:"w-full"}),(0,t.createElement)("p",{className:"text-xs text-wp-sub italic mt-1"},(0,c.__)("Last processed:","craftsman-suite")," ",(0,t.createElement)("span",{className:"text-gray-600"},E||(0,c.__)("Waiting…","craftsman-suite")))),(0,t.createElement)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 py-2"},(0,t.createElement)("div",{className:"flex flex-col border-l-4 border-green-500 bg-white pl-4 py-1"},(0,t.createElement)("span",{className:"text-xs font-medium text-wp-sub uppercase tracking-wide"},(0,c.__)("Completed","craftsman-suite")),(0,t.createElement)("div",{className:"flex items-baseline mt-1"},(0,t.createElement)("span",{className:"text-2xl font-semibold text-gray-900"},b.completed),(0,t.createElement)("span",{className:"ml-2 text-sm text-gray-500"},(0,c.__)("items","craftsman-suite")))),(0,t.createElement)("div",{className:"flex flex-col border-l-4 border-red-500 bg-white pl-4 py-1"},(0,t.createElement)("span",{className:"text-xs font-medium text-wp-sub uppercase tracking-wide"},(0,c.__)("Failed","craftsman-suite")),(0,t.createElement)("div",{className:"flex items-baseline mt-1"},(0,t.createElement)("span",{className:"text-2xl font-semibold text-gray-900"},b.failed),(0,t.createElement)("span",{className:"ml-2 text-sm text-gray-500"},(0,c.__)("items","craftsman-suite")))),(0,t.createElement)("div",{className:"flex flex-col border-l-4 border-orange-500 bg-white pl-4 py-1"},(0,t.createElement)("span",{className:"text-xs font-medium text-wp-sub uppercase tracking-wide"},(0,c.__)("Pending","craftsman-suite")),(0,t.createElement)("div",{className:"flex items-baseline mt-1"},(0,t.createElement)("span",{className:"text-2xl font-semibold text-gray-900"},b.pending),(0,t.createElement)("span",{className:"ml-2 text-sm text-gray-500"},(0,c.__)("items","craftsman-suite"))))),e&&(0,t.createElement)(s.Notice,{status:"success",isDismissible:!1},(0,c.sprintf)((0,c.__)("Successfully regenerated thumbnails for %d images in %d seconds.","craftsman-suite"),b.completed,b.duration)),g&&(0,t.createElement)(s.Notice,{status:g.type,onRemove:()=>x(null)},g.message)),(0,t.createElement)(s.CardFooter,{className:"pt-4 border-t border-gray-100 flex flex-col sm:flex-row gap-3"},e&&(0,t.createElement)(s.Button,{variant:"primary",onClick:()=>window.location.href=window.craftsmanSuiteData.admin_url+"upload.php"},(0,c.__)("Return to Media Library","craftsman-suite")),(e||a)&&(0,t.createElement)(s.Button,{variant:"secondary",onClick:z},(0,c.__)("Start Over","craftsman-suite")),(0,t.createElement)("div",{className:"flex-grow"}),r&&(0,t.createElement)(s.Button,{variant:"link",isDestructive:!0,onClick:C},(0,c.__)("Stop Process","craftsman-suite"))))})())},m=()=>((0,a.useEffect)(()=>{window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&document.documentElement.classList.add("dark"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{e.matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")})},[]),(0,t.createElement)("div",{className:"px-4 sm:px-8 lg:px-12 py-8 max-w-6xl mx-auto"},(0,t.createElement)("header",{className:"mb-8"},(0,t.createElement)("h1",{className:"text-3xl font-normal text-wp-text mb-2"},(0,c.__)("Craftsman Suite","craftsman-suite")),(0,t.createElement)("p",{className:"text-sm text-wp-sub leading-relaxed max-w-3xl"},(0,c.__)("Utility tools for WordPress developers to automate common tasks and streamline workflow.","craftsman-suite"))),(0,t.createElement)("div",{className:"bg-wp-surface dark:bg-[#2c3338] border-l-4 border-wp-primary shadow-wp-card p-4 mb-8 flex items-start rounded-r-sm"},(0,t.createElement)("span",{className:"dashicons dashicons-info text-wp-primary mr-3 mt-0.5 flex-shrink-0"}),(0,t.createElement)("div",null,(0,t.createElement)("p",{className:"text-sm text-wp-text leading-relaxed"},(0,c.__)("Make sure to backup your database before running bulk operations.","craftsman-suite")))),(0,t.createElement)(l,null),(0,t.createElement)(i,null),(0,t.createElement)("footer",{className:"mt-12 pt-6 border-t border-wp-border flex justify-between items-center text-xs text-wp-sub"},(0,t.createElement)("p",null,(0,c.__)("Powered by passion and lots of coffee.","craftsman-suite"),(0,t.createElement)("a",{className:"text-wp-primary hover:underline",href:"https://github.com/calm-canvas/craftsman-suite"},"Documentation"),"."))));document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("craftsman-suite-dev-tools-root");e&&(0,a.render)((0,t.createElement)(m,null),e)})})();