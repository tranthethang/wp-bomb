(() => {
	function F() {
		let r = document.querySelector('form[name="bomb-auto-thumbs-form"]');
		r &&
			r.addEventListener('submit', function (N) {
				confirm(
					'Are you sure you want to attach thumbnails? This will set thumbnails for posts based on the specified ID range.'
				) || N.preventDefault();
			});
	}
	function M() {
		let {
				useState: r,
				useEffect: N,
				useRef: _,
				useCallback: W,
				useMemo: X,
			} = wp.element,
			{ render: O } = wp.element,
			S = wp.apiFetch,
			e = wp.element.createElement,
			j = ({
				settings: s,
				onSettingsChange: i,
				onStart: g,
				availableSizes: n,
				isLoadingSizes: l,
			}) => {
				let d = (t) => {
						i({ batchSize: parseInt(t.target.value) || 1 });
					},
					c = (t) => {
						let b = s.selectedSizes.includes(t)
							? s.selectedSizes.filter((m) => m !== t)
							: [...s.selectedSizes, t];
						i({ selectedSizes: b });
					},
					x = () => {
						i({ skipExisting: !s.skipExisting });
					};
				return e(
					'div',
					{
						className:
							'bg-white border border-wp-border shadow-wp-card rounded-none sm:rounded-[3px] overflow-hidden',
					},
					e(
						'form',
						{
							className: 'p-0',
							onSubmit: (t) => {
								t.preventDefault(), g();
							},
						},
						e(
							'div',
							{ className: 'divide-y divide-gray-100' },
							e(
								'div',
								{
									className:
										'grid grid-cols-1 md:grid-cols-3 gap-6 p-6 items-start',
								},
								e(
									'div',
									{ className: 'md:col-span-1' },
									e(
										'label',
										{
											className: 'text-sm font-semibold text-wp-heading',
											htmlFor: 'batch_size',
										},
										'Images per Batch'
									),
									e(
										'p',
										{ className: 'text-xs text-gray-500 mt-1 leading-relaxed' },
										'The number of images processed in a single AJAX request.'
									)
								),
								e(
									'div',
									{ className: 'md:col-span-2' },
									e(
										'div',
										{ className: 'flex items-center gap-4 max-w-md' },
										e('input', {
											className:
												'w-20 text-center font-medium border-gray-300 rounded-[3px] text-[14px] py-1.5 px-3 focus:border-wp-primary focus:ring-1 focus:ring-wp-primary shadow-sm',
											id: 'batch_size',
											type: 'number',
											min: 1,
											max: 50,
											value: s.batchSize,
											onChange: d,
										}),
										e(
											'div',
											{ className: 'flex-grow' },
											e('input', {
												className:
													'w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-wp-primary',
												id: 'batch_slider',
												type: 'range',
												min: 1,
												max: 50,
												value: s.batchSize,
												onChange: d,
											})
										)
									),
									e(
										'p',
										{
											className:
												'mt-2 text-xs text-gray-500 italic flex items-center gap-1',
										},
										e(
											'span',
											{
												className:
													'material-symbols-outlined text-[16px] text-gray-400',
											},
											'info'
										),
										' Low (5-10) for shared hosting, High (20+) for dedicated servers.'
									)
								)
							),
							e(
								'div',
								{
									className:
										'grid grid-cols-1 md:grid-cols-3 gap-6 p-6 items-start',
								},
								e(
									'div',
									{ className: 'md:col-span-1' },
									e(
										'label',
										{ className: 'text-sm font-semibold text-wp-heading' },
										'Target Thumbnail Sizes'
									),
									e(
										'p',
										{ className: 'text-xs text-gray-500 mt-1 leading-relaxed' },
										'Select specific sizes to regenerate to save time and resources.'
									)
								),
								e(
									'div',
									{ className: 'md:col-span-2 space-y-3' },
									l
										? e(
												'p',
												{ className: 'text-sm text-gray-400 italic' },
												'Loading registered sizes...'
										  )
										: Object.entries(n).map(([t, b]) => {
												let m = `wp-bomb-size-${t}`;
												return e(
													'label',
													{
														key: t,
														htmlFor: m,
														className: 'flex items-start cursor-pointer group',
													},
													e('input', {
														id: m,
														type: 'checkbox',
														checked: s.selectedSizes.includes(t),
														onChange: () => c(t),
														style: {
															marginRight: '8px',
															marginTop: '2px',
															cursor: 'pointer',
														},
													}),
													e(
														'span',
														{
															className:
																'text-[13px] text-wp-text group-hover:text-wp-heading',
														},
														b
													),
													e('div', {
														className: 'flex-grow pointer-events-none',
													})
												);
										  })
								)
							),
							e(
								'div',
								{
									className:
										'grid grid-cols-1 md:grid-cols-3 gap-6 p-6 items-start',
								},
								e(
									'div',
									{ className: 'md:col-span-1' },
									e(
										'label',
										{ className: 'text-sm font-semibold text-wp-heading' },
										'Advanced Options'
									)
								),
								e(
									'div',
									{ className: 'md:col-span-2' },
									(() => {
										let t = 'wp-bomb-skip-existing';
										return e(
											'label',
											{
												htmlFor: t,
												className: 'flex items-start cursor-pointer group',
											},
											e('input', {
												id: t,
												type: 'checkbox',
												checked: s.skipExisting,
												onChange: x,
												style: {
													marginRight: '8px',
													marginTop: '2px',
													cursor: 'pointer',
													flexShrink: 0,
												},
											}),
											e(
												'div',
												{ className: 'text-[13px]' },
												e(
													'span',
													{
														className:
															'block text-wp-text font-medium group-hover:text-wp-heading',
													},
													'Skip existing correctly sized thumbnails'
												),
												e(
													'span',
													{ className: 'block text-gray-500 text-xs mt-0.5' },
													'Only regenerate if the file is missing or dimensions are incorrect.'
												)
											),
											e('div', { className: 'flex-grow pointer-events-none' })
										);
									})()
								)
							)
						),
						e(
							'div',
							{
								className:
									'bg-gray-50 border-t border-wp-border px-6 py-4 flex items-center justify-end',
							},
							e(
								'button',
								{
									type: 'submit',
									className:
										'bg-wp-primary text-white text-[13px] font-medium border border-wp-primary rounded-[3px] px-4 py-2 cursor-pointer transition ease-in-out duration-150 hover:bg-wp-primary-hover hover:border-wp-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-wp-primary',
								},
								'Start Regenerating Thumbnails'
							)
						)
					)
				);
			},
			D = ({
				stats: s,
				status: i,
				lastProcessed: g,
				onStop: n,
				onStartOver: l,
				onReturn: d,
			}) => {
				let c = i === 'completed',
					x = i === 'stopped',
					t = i === 'processing';
				return e(
					'div',
					{
						className:
							'bg-wp-surface border border-wp-border shadow-wp-card sm:rounded-sm',
					},
					e(
						'div',
						{
							className:
								'px-4 py-4 sm:px-6 border-b border-wp-border flex justify-between items-center bg-white',
						},
						e(
							'h3',
							{ className: 'text-sm font-semibold text-gray-900' },
							'Progress'
						),
						e(
							'span',
							{
								className: `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
									c
										? 'bg-green-100 text-green-800'
										: t
										? 'bg-blue-100 text-blue-800'
										: 'bg-gray-100 text-gray-800'
								}`,
							},
							i.charAt(0).toUpperCase() + i.slice(1)
						)
					),
					e(
						'div',
						{ className: 'p-4 sm:p-6 space-y-6' },
						e(
							'div',
							{ className: 'space-y-2' },
							e(
								'div',
								{ className: 'flex justify-between text-sm text-wp-sub mb-1' },
								e(
									'span',
									null,
									'Processing image ',
									e('strong', { className: 'text-gray-800' }, s.processed),
									' of ',
									e('strong', { className: 'text-gray-800' }, s.total)
								),
								e(
									'span',
									{ className: 'font-medium text-gray-800' },
									`${s.percentage}%`
								)
							),
							e(
								'div',
								{
									className:
										'w-full bg-gray-200 rounded-sm h-5 overflow-hidden shadow-inner border border-gray-300 relative',
								},
								e(
									'div',
									{
										className:
											'bg-wp-primary h-full transition-all duration-300 ease-out flex items-center justify-end relative overflow-hidden',
										style: { width: `${s.percentage}%` },
									},
									t &&
										e('div', {
											className:
												'absolute inset-0 bg-[linear-gradient(45deg,rgba(255,255,255,.15)_25%,transparent_25%,transparent_50%,rgba(255,255,255,.15)_50%,rgba(255,255,255,.15)_75%,transparent_75%,transparent)] bg-[length:1rem_1rem] animate-[progress-bar-stripes_1s_linear_infinite]',
										})
								)
							),
							e(
								'p',
								{ className: 'text-xs text-wp-sub italic mt-1' },
								'Last processed: ',
								e('span', { className: 'text-gray-600' }, g || 'Waiting...')
							)
						),
						e(
							'div',
							{ className: 'grid grid-cols-1 md:grid-cols-3 gap-4 py-2' },
							e(
								'div',
								{
									className:
										'flex flex-col border-l-4 border-wp-success bg-white pl-4 py-1',
								},
								e(
									'span',
									{
										className:
											'text-xs font-medium text-wp-sub uppercase tracking-wide',
									},
									'Completed'
								),
								e(
									'div',
									{ className: 'flex items-baseline mt-1' },
									e(
										'span',
										{ className: 'text-2xl font-semibold text-gray-900' },
										s.completed
									),
									e(
										'span',
										{ className: 'ml-2 text-sm text-gray-500' },
										'items'
									)
								)
							),
							e(
								'div',
								{
									className:
										'flex flex-col border-l-4 border-wp-error bg-white pl-4 py-1',
								},
								e(
									'span',
									{
										className:
											'text-xs font-medium text-wp-sub uppercase tracking-wide',
									},
									'Failed'
								),
								e(
									'div',
									{ className: 'flex items-baseline mt-1' },
									e(
										'span',
										{ className: 'text-2xl font-semibold text-gray-900' },
										s.failed
									),
									e(
										'span',
										{ className: 'ml-2 text-sm text-gray-500' },
										'items'
									)
								)
							),
							e(
								'div',
								{
									className:
										'flex flex-col border-l-4 border-wp-warning bg-white pl-4 py-1',
								},
								e(
									'span',
									{
										className:
											'text-xs font-medium text-wp-sub uppercase tracking-wide',
									},
									'Pending'
								),
								e(
									'div',
									{ className: 'flex items-baseline mt-1' },
									e(
										'span',
										{ className: 'text-2xl font-semibold text-gray-900' },
										s.pending
									),
									e(
										'span',
										{ className: 'ml-2 text-sm text-gray-500' },
										'items'
									)
								)
							)
						),
						c &&
							e(
								'div',
								{
									className:
										'bg-white border-l-4 border-wp-success p-4 shadow-sm',
								},
								e(
									'div',
									{ className: 'flex' },
									e(
										'div',
										{ className: 'flex-shrink-0' },
										e(
											'span',
											{
												className:
													'material-symbols-outlined text-wp-success text-xl',
											},
											'check_circle'
										)
									),
									e(
										'div',
										{ className: 'ml-3' },
										e(
											'p',
											{ className: 'text-sm font-medium text-gray-900' },
											'All done!'
										),
										e(
											'div',
											{ className: 'mt-1 text-sm text-wp-sub' },
											e(
												'p',
												null,
												`Successfully regenerated thumbnails for ${s.completed} images in ${s.duration} seconds.`
											)
										)
									)
								)
							),
						e(
							'div',
							{
								className:
									'pt-4 border-t border-gray-100 flex flex-col sm:flex-row gap-3',
							},
							c &&
								e(
									'button',
									{
										onClick: d,
										className:
											'inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded transition duration-150 ease-in-out border bg-wp-primary text-white border-wp-primary hover:bg-wp-primary-hover hover:border-wp-primary-hover',
									},
									'Return to Media Library'
								),
							(c || x) &&
								e(
									'button',
									{
										onClick: l,
										className:
											'inline-flex items-center justify-center px-3 py-1.5 text-sm font-medium rounded transition duration-150 ease-in-out border bg-white text-gray-700 border-gray-300 hover:border-gray-400 hover:text-gray-800',
									},
									'Start Over'
								),
							e('div', { className: 'flex-grow' }),
							t &&
								e(
									'button',
									{
										onClick: n,
										className:
											'text-red-600 hover:text-red-700 hover:bg-red-50 border-transparent text-sm font-medium px-3 py-1.5 rounded transition duration-150 ease-in-out',
									},
									'Stop Process'
								)
						)
					)
				);
			},
			P = () => {
				let [s, i] = r('settings'),
					[g, n] = r('idle'),
					[l, d] = r({
						batchSize: wpBombData.batch_size || 10,
						selectedSizes: [],
						skipExisting: !1,
					}),
					[c, x] = r({}),
					[t, b] = r(!0),
					[m, y] = r({
						total: 0,
						processed: 0,
						completed: 0,
						failed: 0,
						pending: 0,
						percentage: 0,
						startTime: null,
						duration: 0,
					}),
					[B, L] = r(''),
					[G, $] = r([]),
					h = _(!0),
					p = _(!1);
				N(
					() => (
						V(),
						() => {
							h.current = !1;
						}
					),
					[]
				);
				let V = async () => {
						try {
							let a = await S({
								path: '/wpbomb/v1/regenerate-thumbnails/sizes',
							});
							h.current &&
								a.success &&
								(x(a.sizes),
								d((o) => ({ ...o, selectedSizes: Object.keys(a.sizes) })),
								b(!1));
						} catch (a) {
							console.error('Failed to fetch sizes', a);
						}
					},
					I = async () => {
						(p.current = !1), n('loading'), i('progress');
						try {
							let a = await S({
								path: '/wpbomb/v1/regenerate-thumbnails/attachments',
							});
							if (!h.current) return;
							if (a.success) {
								let o = a.attachment_ids;
								$(o),
									y({
										total: a.total,
										processed: 0,
										completed: 0,
										failed: 0,
										pending: a.total,
										percentage: 0,
										startTime: Date.now(),
										duration: 0,
									}),
									n('processing'),
									A(o, 0, { completed: 0, failed: 0 });
							}
						} catch (a) {
							console.error('Failed to start process', a), n('error');
						}
					},
					A = async (a, o, C) => {
						if (!h.current || p.current) {
							p.current && n('stopped');
							return;
						}
						if (o >= a.length) {
							let f = Date.now(),
								k = Math.round((f - m.startTime) / 1e3);
							y((w) => ({ ...w, duration: k, pending: 0, percentage: 100 })),
								n('completed');
							return;
						}
						let R = a.slice(o, o + l.batchSize);
						try {
							let f = await S({
								path: '/wpbomb/v1/regenerate-thumbnails/batch-process',
								method: 'POST',
								data: {
									attachment_ids: R,
									selected_sizes: l.selectedSizes,
									skip_existing: l.skipExisting,
								},
							});
							if (!h.current || p.current) {
								p.current && n('stopped');
								return;
							}
							let k = f.results || {},
								w = C.completed,
								z = C.failed,
								T = '';
							Object.values(k).forEach((u) => {
								u.success ? (w++, (T = u.filename)) : z++;
							});
							let v = o + R.length,
								J = Math.round((v / a.length) * 100);
							y((u) => ({
								...u,
								processed: v,
								completed: w,
								failed: z,
								pending: a.length - v,
								percentage: J,
							})),
								T && L(T),
								await new Promise((u) => setTimeout(u, 50)),
								A(a, v, { completed: w, failed: z });
						} catch (f) {
							console.error('Batch failed', f), n('error');
						}
					},
					q = () => {
						p.current = !0;
					},
					H = () => {
						i('settings'),
							n('idle'),
							y({
								total: 0,
								processed: 0,
								completed: 0,
								failed: 0,
								pending: 0,
								percentage: 0,
								startTime: null,
								duration: 0,
							}),
							L('');
					};
				return e(
					'div',
					{ className: '' },
					e(
						'div',
						{ className: 'mb-6' },
						e(
							'h1',
							{ className: 'text-2xl font-medium text-gray-800 mb-2' },
							'Regenerate Thumbnails'
						),
						e(
							'p',
							{
								className: 'text-[13px] text-wp-sub leading-relaxed max-w-4xl',
							},
							'This tool regenerates thumbnails for all image attachments. This is useful if you have changed your theme or one of your thumbnail dimensions.'
						)
					),
					s === 'settings'
						? e(j, {
								settings: l,
								availableSizes: c,
								isLoadingSizes: t,
								onSettingsChange: (a) => d((o) => ({ ...o, ...a })),
								onStart: I,
						  })
						: e(D, {
								stats: m,
								status: g,
								lastProcessed: B,
								onStop: q,
								onStartOver: H,
								onReturn: () =>
									(window.location.href = wpBombData.admin_url + 'upload.php'),
						  }),
					e(
						'div',
						{
							className:
								'mt-8 text-center sm:text-left border-t border-gray-200 pt-6',
						},
						e(
							'p',
							{ className: 'text-xs text-gray-500' },
							'Need help? ',
							e(
								'a',
								{
									className:
										'text-wp-primary hover:text-wp-primary-hover hover:underline',
									href: '#',
								},
								'View documentation'
							)
						)
					),
					e(
						'style',
						null,
						`
				@keyframes progress-bar-stripes {
					from { background-position: 1rem 0; }
					to { background-position: 0 0; }
				}
				.animate-progress-bar-stripes {
					animation: progress-bar-stripes 1s linear infinite;
				}
			`
					)
				);
			},
			E = document.getElementById('wp-bomb-regenerate-thumbnails-root');
		E && O(e(P), E);
	}
	function U() {
		window.matchMedia &&
			window.matchMedia('(prefers-color-scheme: dark)').matches &&
			document.documentElement.classList.add('dark'),
			window
				.matchMedia('(prefers-color-scheme: dark)')
				.addEventListener('change', (r) => {
					r.matches
						? document.documentElement.classList.add('dark')
						: document.documentElement.classList.remove('dark');
				});
	}
	document.addEventListener('DOMContentLoaded', function () {
		F(), M(), U();
	});
})();
